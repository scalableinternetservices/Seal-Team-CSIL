<% content_for :javascript_includes do %>
    <%= javascript_include_tag "map.js" %>
<% end %>

<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- <link href="assets/css/bootstrap-responsive.css" rel="stylesheet"> -->
<!-- <%= stylesheet_link_tag    'bootstrap-responsive', media: 'all', 'data-turbolinks-track' => true %> -->
<h1 class='center_graph'> Check out Local Deals! </h1>

<!-- <div style='width: 1000px;'>
    <div id="map" style='width: 1000px; height: 400px; background-position: center;'></div>
</div> -->

<div class="map_container">
    <div id="map_canvas" class="map_canvas"></div>
</div>

<div class = 'center_graph'>
  <%= link_to "Delete All Deals", delete_all_user_deals_path, method: "delete" %><br>
  <%= link_to "Delete All Users", delete_all_users_path, method: "delete" %>
</div>


<!-- Side Bar -->
<div class="side_bar" style="color: #333333">
    
<!-- Filters -->
<!--    <h3 style="min-height: 60px; text-align: center" >Filters:</h3> -->
    <h3 class="side_bar_item" style="text-align: center" >Filters:</h3>

<!-- Empty Side Bar Item -->    
    <li class="side_bar_item"></li>

    
<!-- Food Type -->
    <div class="dropdown">
        <button id="food_type" class="side_bar_button" type="button" data-toggle="dropdown">Food Type
        <span class="caret"></span></button>
        <ul class="dropdown-menu" border="none">
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Any Type', 'food_type' )">Any Type</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Asian', 'food_type' )">Asian</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'American', 'food_type' )">American</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'French', 'food_type' )">French</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Italian', 'food_type' )">Italian</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Mexican', 'food_type' )">Mexican</li>
        </ul>
    </div>
    
    
<!-- Deal Type -->
    <div class="dropdown">
        <button id="deal_type" class="side_bar_button" type="button" data-toggle="dropdown">Deal Type
        <span class="caret"></span></button>
        <ul class="dropdown-menu" border="none">
            <li class="side_bar_dropdown" onclick="setDropDownName( 'All Deals', 'deal_type' )">All Deals</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Free', 'deal_type' )">Free</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Buy One Get One Free', 'deal_type' )">Buy One Get One Free</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Buy One Get One Half Off', 'deal_type' )">Buy One Get One Half Off</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Flash Deal', 'deal_type' )">Flash Deal</li>
        </ul>
    </div>    
    
<!-- Distance -->
    <div class="dropdown">
        <button id="distance" class="side_bar_button" type="button" data-toggle="dropdown">Distance(Miles)
        <span class="caret"></span></button>
        <ul class="dropdown-menu" border="none">
            <li class="side_bar_dropdown" onclick="setDropDownName( 'Everywhere', 'distance' )">Everywhere</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '1', 'distance' )">1</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '5', 'distance' )">5</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '10', 'distance' )">10</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '15', 'distance' )">15</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '20', 'distance' )">20</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '25', 'distance' )">25</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '30', 'distance' )">30</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '50', 'distance' )">50</li>
            <li class="side_bar_dropdown" onclick="setDropDownName( '100', 'distance' )">100</li>
        </ul>
    </div>

  <!-- Address -->
    <form id="address" class="side_bar_item">Address:
      <input type="text" id="street_address"
             value="Lagoon Rd, Isla Vista, CA 93117, USA"
             style="color: black; width: 180px">
      </input>
    </form>

  <!-- LatLong -->
  <form id="lat_lng" class="side_bar_item">Lat, Long:
    <input type="text" id="lat_lng"
           value="34.4137495,-119.84165970000001"
           style="color: black; width: 180px">
    </input>
  </form>

    
<!-- Empty Side Bar Item -->    
    <li class="side_bar_item"></li>
    
<!-- Update Map -->
  <!--<div class="side_bar_button"><%=link_to "Search", load_deals_path %> </div>-->
  <button id="update_map" class="side_bar_button" onClick="getFilters()">Search</button>

</div>


<!-- Sets the variable in the dropdown menu to the value selected -->
<script type="text/javascript">
    function setDropDownName( s, id ) {
        document.getElementById( id ).innerHTML = s + ' <span class="caret"></span>';
    }
</script>

<script type="text/javascript">
    function getFilters() {
        $.ajax({
            url: "graph/load_filter_deals",
            type: "GET",
//            data: {food_type : document.getElementById( 'food_type' ).textContent,
//                    deal_type: document.getElementById( 'deal_type' ).textContent,
//                    distance : document.getElementById( 'distance'  ).textContent },
//                    street_address: document.getElementById( 'street_address' ),
//                    lat_lng: document.getElementById( 'lat_lng' )},
            data: { lat: 0 },
            dataType: 'json'
        });
    }
</script>

<script type="text/javascript">
    <% if @lat.present? && @lng.present?%>
        getViewerLocation(<%= @lat %>, <%= @lng %>);
    <% else %>
        findUser();
    <% end %>
</script>

